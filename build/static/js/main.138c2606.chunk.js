(this["webpackJsonpipfs-gallery-viewer"]=this["webpackJsonpipfs-gallery-viewer"]||[]).push([[0],{261:function(e,t){},272:function(e,t){},294:function(e,t){},295:function(e,t){},564:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(78),i=n.n(a),o=n(44),s=n(24),u=n(70),j=n(105),l=n(2),b=n.n(l),d=n(69),h=n(220),O=n.n(h),f=n(580),p=n(10),x=n(573),v=n(574),g=n(575),m=n(6),w=c.a.createContext({}),S=function(){return Object(r.useContext)(w)},y=function(e){var t=e.children,n=Object(x.a)("setup"),c=Object(p.a)(n,3),a=c[0],i=c[1],o=c[2],s=Object(x.a)("ipfs-api-url"),u=Object(p.a)(s,3),j=u[0],l=u[1],b=u[2],d=Object(x.a)("ipfs-gateway","https://ipfs.io"),h=Object(p.a)(d,3),O=h[0],f=h[1],S=h[2],y=Object(x.a)("thumbor-url"),k=Object(p.a)(y,3),C=k[0],F=k[1],U=k[2],I=Object(x.a)("galleries","/galleries"),P=Object(p.a)(I,3),R=P[0],T=P[1],G=P[2],M=Object(v.a)();Object(g.a)("storage",M,window);var L=Object(r.useCallback)((function(){o(),b(),G(),U()}),[o,b,G,U]),A={setup:a,setSetup:i,clearSetup:o,apiUrl:j,setApiUrl:l,clearApiUrl:b,gateway:O,setGateway:f,clearGateway:S,thumbor:C,setThumbor:F,clearThumbor:U,rootFolder:R,setRootFolder:T,clearRootFolder:G,clear:L};return Object(m.jsx)(w.Provider,{value:A,children:t})},k=c.a.createContext(),C=function(){return Object(r.useContext)(k)},F=function(e){var t=e.children,n=e.repo,c=S(),a=c.ipfsMode,i=c.setup,o=c.apiUrl,s=Object(f.a)(Object(d.a)(b.a.mark((function e(){var t,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",null);case 2:if(!o){e.next=15;break}return console.info("connecting to remote node"),e.next=6,O()({url:o});case 6:return t=e.sent,e.next=9,t.id();case 9:return n=e.sent,r=n.id,console.log("connected to ".concat(r)),e.abrupt("return",t);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)}))),[n,o,a,i]),u=Object(r.useMemo)((function(){return{error:s.error,loading:s.loading,ipfs:s.value}}),[s]);return Object(r.useEffect)((function(){u.loading||window.ipfs===u.ipfs||(window.ipfs=u.ipfs)}),[u]),Object(m.jsx)(k.Provider,{value:u,children:t})},U=function(e){var t=e.children,n=e.direct,r=void 0===n?"/settings":n,c=Object(j.a)(e,["children","direct"]),a=C(),i=a.loading;return a.ipfs?Object(m.jsx)(s.a,Object(u.a)(Object(u.a)({},c),{},{children:t})):i?Object(m.jsx)("h1",{children:"Setting up IPFS..."}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("h1",{children:"looks like IPFS is not working"}),Object(m.jsx)(o.b,{to:r,children:"Go to settings"})]})},I=n(221),P=n(222),R=n.n(P),T=n(576),G=n(577),M=n(223),L=n(583),A=n(582),E=function(e){var t=e.children,n=Object(j.a)(e,["children"]);return Object(m.jsx)(A.a,Object(u.a)(Object(u.a)({as:o.b},n),{},{children:t}))},B=function(){return Object(m.jsx)(T.a,{as:"nav",w:"100%",padding:"2",children:Object(m.jsxs)(G.a,{justifyContent:"space-between",children:[Object(m.jsxs)(M.a,{children:[Object(m.jsx)(E,{to:"/",children:"Home"}),Object(m.jsx)(E,{to:"/folder",children:"Browse"}),Object(m.jsx)(E,{to:"/settings",children:"Settings"})]}),Object(m.jsx)("form",{action:"/watch",children:Object(m.jsx)(L.a,{placeholder:"youtube id",name:"v"})})]})})},H=function(e){var t=e.children;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(B,{}),Object(m.jsx)("div",{children:t})]})},J=c.a.createContext(""),z=/\.(jpg|jpeg|png)/i,D=function(){var e=C().ipfs,t=Object(s.f)().pathname,n=S(),c=n.gateway,a=n.thumbor,i=t.replace(/^\/folder/,"")||"/",u=Object(f.a)(Object(d.a)(b.a.mark((function t(){var n,r,c,a,o,s,u,j,l;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.files.ls(i),r=[],c=!0,a=!1,t.prev=4,s=Object(I.a)(n);case 6:return t.next=8,s.next();case 8:return u=t.sent,c=u.done,t.next=12,u.value;case 12:if(j=t.sent,c){t.next=19;break}l=j,r.push(l);case 16:c=!0,t.next=6;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(4),a=!0,o=t.t0;case 25:if(t.prev=25,t.prev=26,c||null==s.return){t.next=30;break}return t.next=30,s.return();case 30:if(t.prev=30,!a){t.next=33;break}throw o;case 33:return t.finish(30);case 34:return t.finish(25);case 35:return t.abrupt("return",r);case 36:case"end":return t.stop()}}),t,null,[[4,21,25,35],[26,,30,34]])}))),[e,i]),j=u.value,l=void 0===j?[]:j,h=(u.loading,u.error,Object(r.useMemo)((function(){return l.filter((function(e){return"directory"===e.type}))}),[l])),O=Object(r.useMemo)((function(){return l.filter((function(e){return"file"===e.type}))}),[l]),p=Object(r.useMemo)((function(){return O.filter((function(e){return z.test(e.name)})).map((function(e){var t="".concat(c,"/ipfs/").concat(e.cid.toString());return{src:t,thumbnail:a?"".concat(a,"/unsafe/128x128/").concat(encodeURIComponent(t)):null,thumbnailWidth:1,thumbnailHeight:1}}))}),[O]);return Object(m.jsxs)(J.Provider,{value:i,children:[Object(m.jsx)("ul",{children:h.map((function(e){return Object(m.jsx)("li",{children:Object(m.jsx)(o.b,{to:"".concat(t,"/").concat(e.name),children:e.name})},e.cid.toString())}))}),Object(m.jsx)(R.a,{images:p,enableImageSelection:!1})]})},N=function(){return Object(m.jsx)(H,{children:Object(m.jsx)(D,{})})};var W=function(){var e=function(){var e=C(),t=e.loading,n=e.ipfs,r=Object(f.a)(Object(d.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,n.id();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),[n]),c=r.loading;return{loading:t||c,id:r.value}}().id;return Object(m.jsx)(H,{children:Object(m.jsx)("h2",{children:e?"IPFS id ".concat(e.id):"connecting to ipfs..."})})},q=n(584),K=n(72),Q=n(578),V=n(579),X=function(){var e=S(),t=C().loading,n=Object(r.useState)(e.apiUrl),c=Object(p.a)(n,2),a=c[0],i=c[1],o=Object(r.useState)(e.rootFolder),s=Object(p.a)(o,2),u=s[0],j=s[1],l=Object(r.useState)(e.gateway),b=Object(p.a)(l,2),d=b[0],h=b[1],O=Object(r.useState)(e.thumbor),f=Object(p.a)(O,2),x=f[0],v=f[1],g=Object(r.useCallback)((function(t){t.preventDefault(),e.setApiUrl(a),e.setGateway(d),e.setRootFolder(u),e.setThumbor(x),e.setSetup(!0)}),[a,e,u,d,x]);return t?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("h1",{children:"Setting up IPFS..."}),Object(m.jsx)(A.a,{onClick:e.clear,children:"clear settings"})]}):Object(m.jsx)("form",{onSubmit:g,children:Object(m.jsxs)(q.a,{spacing:2,children:[Object(m.jsxs)(K.a,{id:"gateway",children:[Object(m.jsx)(Q.a,{children:"IPFS Gateway"}),Object(m.jsx)(L.a,{value:null!==d&&void 0!==d?d:"",onChange:function(e){return h(e.target.value)}}),Object(m.jsx)(K.b,{children:"The URL to the api endpoint of the IPFS node"})]}),Object(m.jsx)(V.a,{}),Object(m.jsxs)(K.a,{id:"api-url",children:[Object(m.jsx)(Q.a,{children:"Ipfs Node Url"}),Object(m.jsx)(L.a,{value:null!==a&&void 0!==a?a:"",onChange:function(e){return i(e.target.value)}}),Object(m.jsx)(K.b,{children:"The URL to the api endpoint of the IPFS node"})]}),Object(m.jsxs)(K.a,{id:"root-folder",children:[Object(m.jsx)(Q.a,{children:"Galleries Path"}),Object(m.jsx)(L.a,{value:null!==u&&void 0!==u?u:"",onChange:function(e){return j(e.target.value)}}),Object(m.jsx)(K.b,{children:"The root folder on the node"})]}),Object(m.jsxs)(K.a,{id:"thumbor-url",children:[Object(m.jsx)(Q.a,{children:"Thumbor URL"}),Object(m.jsx)(L.a,{value:null!==x&&void 0!==x?x:"",onChange:function(e){return v(e.target.value)}}),Object(m.jsx)(K.b,{children:"The URL to a thumbor server for resizing thumbnails"})]}),Object(m.jsx)(A.a,{type:"submit",children:"save"})]})})},Y=function(){return Object(m.jsx)(H,{children:Object(m.jsx)(X,{})})},Z=function(){return Object(m.jsxs)(s.c,{children:[Object(m.jsx)(s.a,{path:"/settings",component:Y}),Object(m.jsx)(U,{path:"/folder",component:N}),Object(m.jsx)(U,{path:"/",component:W})]})},$=n(581),_=function(e){var t=e.children;return Object(m.jsx)($.a,{children:Object(m.jsx)(y,{children:Object(m.jsx)(F,{repo:"ipfs-gallery-viewer",children:t})})})},ee=document.createElement("div");ee.id="root",document.body.appendChild(ee),i.a.render(Object(m.jsx)(o.a,{children:Object(m.jsx)(_,{children:Object(m.jsx)(Z,{})})}),document.getElementById("root"))}},[[564,1,2]]]);
//# sourceMappingURL=main.138c2606.chunk.js.map